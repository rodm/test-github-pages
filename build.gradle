
buildscript {
    repositories {
        mavenLocal()
        maven {
            url "https://plugins.gradle.org/m2/"
        }
    }

    dependencies {
        classpath 'me.champeau.gradle:jbake-gradle-plugin:0.2'
        classpath 'org.ajoberstar:gradle-git:1.6+'
        classpath 'org.ajoberstar:gradle-git-publish:0.1.0'
        classpath 'org.asciidoctor:asciidoctor-java-integration:0.1.4'
        classpath 'org.pegdown:pegdown:1.4.2'
        classpath 'org.freemarker:freemarker:2.3.19'
    }
}

apply plugin: 'base'
apply plugin: 'me.champeau.jbake'

jbake {
    version = '2.3.2'

    input = file('src/jbake')
    output = file('build/jbake')

    clearCache = true
}

apply plugin: 'org.ajoberstar.github-pages'
githubPages {
    repoUri = 'git@github.com:rodm/test-github-pages.git'
    targetBranch = 'test'
    pages {
        from (file('build/jbake')) {
            exclude '**/*-draft.html'
            into '.'
        }
    }
}

apply plugin: 'org.ajoberstar.git-publish'
gitPublish {
    repoUri = 'git@github.com:rodm/test-github-pages.git'
    branch = 'test'
    contents {
        from(file('build/jbake')) {
            exclude '**/*-draft.html'
            into '.'
        }
    }
}
